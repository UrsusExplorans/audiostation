version: '3'

volumes:
  mopidy_config:
  mopidy_data:

services:
  mopidy:
    image: audiostation/mopidy:v1.1
    ports:
      - "6600:6600"
      - "6680:6680"
      - "5555:5555"
    depends_on:
      - snapserver
    volumes:
      - /tmp/sharesound:/tmp/sharesound
      - mopidy_config:/etc/mopidy
      - ./mopidy-master.conf:/etc/mopidy/mopidy.conf:ro
      - mopidy_data:/var/lib/mopidy
    restart: unless-stopped

  snapserver:
    image: audiostation/snapcast
    volumes:
      - /tmp/sharesound:/tmp/sharesound
    command: "snapserver -s pipe:///tmp/sharesound/snapfifo?name=Radio"
    ports:
      - "1704:1704"
      - "1705:1705"
    restart: unless-stopped

  # Turn this on if you have no other snapcast client on the server
  #snapclient:
  #  image: audiostation/snapcast
  #  links:
  #   - snapserver:snapserverhost
  #  depends_on:
  #    - snapserver
  #  devices:
  #   - "/dev/snd/:/dev/snd/"
  #  command: "snapclient -h snapserver"
  #  restart: unless-stopped
