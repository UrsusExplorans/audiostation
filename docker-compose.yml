version: '3'

volumes:
  mopidy_config:
  mopidy_data:

#networks:
#  default:
#    external:
#      name: nginx-proxy

services:
#  data:
#    build:
#      context: .

  mopidy:
    image: audiostation/mopidy
    ports:
      - "6600:6600"
      - "6680:6680"
      - "5555:5555"
    depends_on:
      - snapserver
    volumes:
      #- ./mopidy-master.conf:/var/lib/mopidy/.config/mopidy/mopidy.conf:ro
      - /tmp/sharesound:/tmp/sharesound
      - mopidy_config:/etc/mopidy
      - ./mopidy-master.conf:/etc/mopidy/mopidy.conf:ro
      - mopidy_data:/var/lib/mopidy
    restart: unless-stopped
    #environment:
    #  #- "PULSE_SERVER=tcp:serv:4713"
    #  - "VIRTUAL_HOST=mopidy.malte.lan"
    #  - "VIRTUAL_PORT=6680"
    #  - "CERT_NAME=wildcast.heim"

  snapserver:
    image: audiostation/snap-server
    volumes:
      - /tmp/sharesound:/tmp/sharesound
    command: "-s pipe:///tmp/sharesound/snapfifo?name=Radio"
    ports:
      - "1704:1704"
      - "1705:1705"
    restart: unless-stopped

  #upmpdcli:
  #  image: audiostation/upmpdcli
  #  depends_on:
  #    - mopidy
  #  command: "-h mopidy -p 6600 -f mopidy"
  #  restart: unless-stopped

  # Turn this on if you have no other snapcast client on the server
  #snapclient:
  #  image: audiostation/snap-client
  #  links:
  #   - snapserver:snapserverhost
  #  depends_on:
  #    - snapserver
  #  devices:
  #   - "/dev/snd/:/dev/snd/"
  #  command: "-h snapserver"
  #  restart: unless-stopped
